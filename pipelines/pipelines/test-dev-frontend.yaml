apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: dev-test-build-frontend
spec:
  params:
    - name: imageTag
      description: Tag of the images to be used.
      default: "default"
    - name: nodeTestImage
      description: Image to be used to node tests
      default: health-test-node
  resources:
    - name: src
      type: git
    - name: builtImage
      type: image
  tasks:
  - name: source-to-image-task
    taskRef:
      name: source-to-image
    params:
      - name: pathToContext
        value: .
      - name: pathToDockerFile
        value: images/frontend/Dockerfile
      - name: imageTag
        value: "${params.imageTag}"
    resources:
      inputs:
        - name: workspace
          resource: src
      outputs:
        - name: builtImage
          resource: builtImage
  - name: tox-npm-lint
    taskRef:
      name: tox
    params:
      - name: environment
        value: npm-lint
      - name: pathToToxIni
        value: /workspace/workspace
      - name: testImage
        value: ${params.nodeTestImage}
    resources:
      inputs:
        - name: workspace
          resource: src
  - name: tox-npm-test
    taskRef:
      name: tox
    params:
      - name: environment
        value: npm-test
      - name: pathToToxIni
        value: /workspace/workspace
      - name: testImage
        value: ${params.nodeTestImage}
    resources:
      inputs:
        - name: workspace
          resource: src
